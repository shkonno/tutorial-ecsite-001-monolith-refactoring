# 対話履歴（構造化）: 2025-12-27T10:50:52+09:00

## 1. Input（ユーザー要望）

### 1.1. `docs/refacroting/` の集約と計画書化

- `docs/refacroting/` 配下（テスト戦略/計画/現状/I/O境界/ドキュメント管理）の情報を集約して構造化
- 統合した **計画書** を作成
- 計画書に沿った **イシューリスト（ユースケース→イシュー→タスク）** を作成

### 1.2. 実装（計画の適用）

- 作成済みのToDoに沿って実装する
- **計画ファイル自体は編集しない**

---

## 2. Fact（観測された事実）

### 2.1. `docs/refacroting/` に既に揃っていた核情報

- 背骨の起点: 「商品一覧 → 商品詳細 → カート追加 → カート表示」
- テスト追加の順序: Unit →（実I/O）Integration → E2E
- ドキュメント方針: “昇格（Living）を先に、物理移動は後”

### 2.2. E2Eの不安定要因（`app/tests/user-flow.spec.ts`）

- `waitForTimeout(...)`: **6箇所**
- `isVisible().catch(() => false)`: **6箇所**
- 弱い/曖昧なセレクタ（例: `[class*="product"], article, .card`）: **10箇所**

### 2.3. CIの現状（GitLab）

- `.gitlab-ci.yml` が存在し、**lint と build は push / merge request で実行**されている
- テスト（Vitest/Playwright）は `app/package.json` にスクリプトはあるが、ゲート化は今後の段階実施

---

## 3. Decision（この対話で決めたこと）

### 3.1. イシューリストの形式

- リポジトリ内Markdownで管理（チェックリスト形式）

### 3.2. 確定スコープ

- まずは **UC0〜UC2** を確定（UC3以降は候補扱い）

---

## 4. Output（作成・変更した成果物）

### 4.1. 統合計画書（Living）

- 追加: `docs/refacroting/MASTER-PLAN.md`
  - `docs/refacroting/refs/*`（既存資料）への参照リンクを整理
  - DoD（UC/Issue）を明文化
  - GitLab CIの現状を踏まえた「PRゲート昇格（段階復帰）」を明文化

### 4.2. 実行用イシューリスト（UC0-UC2）

- 追加: `docs/refacroting/ISSUES-UC0-UC2.md`
  - ユースケース → イシュー（2h）→ タスク（30m）の粒度でチェックリスト化
  - `user-flow.spec.ts` のフレーク要因を「分類テンプレ」でIssue化できる形に整理

### 4.3. ADRテンプレ

- 追加: `docs/architecture/decisions/ADR-TEMPLATE.md`
  - 3案比較（Option A/B/C）を前提にした最小テンプレ

### 4.4. 作業時間計測ルール（Work Time Tracking）

- 追加: `docs/operations/work-time-tracking.md`
  - Active/Wait/Research/Interrupt を分離して記録する最小ルール
  - 1UC=1レコードのテンプレ＋サンプル

### 4.5. docs索引（入口の更新）

- 更新: `docs/README.md`
  - リファクタ計画（`refacroting/MASTER-PLAN.md` / `refacroting/ISSUES-UC0-UC2.md`）への入口を追加
  - ドキュメント管理のリンク先を `refacroting/refs/document-management.md` に修正

---

## 5. Next（次にやること候補）

- UC0（ガードレール）から着手し、計測とADR運用を“先に固定”する
  - I0-1: 計測カテゴリ/記録テンプレの確定（`docs/operations/work-time-tracking.md` に運用を載せる）
  - I0-2: ADRテンプレ運用（`docs/architecture/decisions/ADR-TEMPLATE.md`）
- UC1: 背骨E2Eの「1本化＋安定化」に入る（固定待ち/弱いセレクタ/握りつぶしを順に解消）
- UC2: 最初の境界切り出しはカート（`lib/actions/cart.ts`）を優先候補として進める

---

## 6. Files（関連ファイル一覧）

- `docs/refacroting/MASTER-PLAN.md`
- `docs/refacroting/ISSUES-UC0-UC2.md`
- `docs/refacroting/refs/testing-strategy.md`
- `docs/refacroting/refs/refactoring-plan.md`
- `docs/refacroting/refs/backbone-io-boundary.md`
- `docs/refacroting/refs/current-status.md`
- `docs/refacroting/refs/document-management.md`
- `docs/architecture/decisions/ADR-TEMPLATE.md`
- `docs/operations/work-time-tracking.md`
- `docs/README.md`
- `app/tests/user-flow.spec.ts`
- `.gitlab-ci.yml`


