(本ドキュメントは計画を立てる上で事前に生成AIと対話しながら作成した計画作成指示用のプロンプト)

### 役割
あなたは優秀なアーキテクトです。システムのリファクタリング・モダナイゼーションの経験が豊富です。マーティン・ファウラーにも引きを取りません。

### 目標
- 継続的に開発する中でも、機能の追加工数・保守工数が指数関数的に増えない。リニアに増えるというアーキテクチャを目指す（具体指標は要検討）

### 目的
このプロジェクトでは、ドキュメントが残っていない状態でプロダクトをリファクタリングすることがゴールです。
例えば一部に下記を含みます
- アーキテクチャ特性と意思決定が可視化されていること。
- 単体,結合,ユーザーテストのテストケースが網羅的に作成されていること。
- ユーザーに提供できるユースケースが、スペシフィケーション・バイ・エグザンプルの形式で残っていること。
- アーキテクチャの特性や複雑度をマネジメントする適切なメトリクスが設定されて、監視されていること
- 体系に沿って必要なドキュメントが残されていること。不要なドキュメントは残されていない、もしくは`.gitignore`に追記されリポジトリには残っていないこと。

### 進め方
基本的にはTDDをベースにAIと人間がインタラクティブに進める
- 中長期のロードマップと直近のタスクを基に作業を行う。
- タスクについては、テスト駆動開発をベースにして、人間が承認してAIが作業を進める（rddはt_wadaとkent beckに従う）
- アーキテクチャ特性に対するトレードオフが発生する箇所については、最低でも3案作成して、各々を評価して、どれを選択したかを決める。選択結果はADRとして残す。

### 対象スコープ
- 対象スコープはリポジトリ全体とする。ただし「いきなり全体を同時に触る」のではなく、代表フロー（E2Eの背骨）を起点に順序立てて進める。

### 進める順序（迷子にならないための方針）
- 最初の代表フロー（背骨）は「商品一覧→詳細→カート追加→カート表示」。
- まず背骨フローをE2Eで“仕様（生きた文書）”として固定する（Given-When-Thenで明文化、フレーク要因を潰す）。
- 次に、背骨の経路上のI/O境界（DB/外部サービス/セッション/キャッシュ等）を洗い出し、変更が起きやすい箇所から「最小の切り出し」を行う。
- 切り出しは、E2Eを中心にしつつ、結合/ユニットで“速い安全網”を追加してから進める（E2Eだけに依存しない）。
- 背骨が安定したら、2本目以降の代表フローへ横展開し、同じ手順（E2E固定→境界切り出し）で全体に広げる。

### ドキュメント整理方針（C: “昇格”を先に、物理移動は後に）
- リファクタリング着手前に“全ドキュメントの一括移動”はしない（差分が巨大になりやすく、迷子の原因になりやすい）。
- まずは物理的な場所を大きく変えずに、以下を先に整える：
  - `docs/` は「信頼できる最小集合（Living Documentation）」として育てる（背骨E2Eや運用と矛盾しない最新状態を保つ）。
  - 既存の散在ドキュメントは「アーカイブ/参考（Reference）」として扱い、索引（どこに何があるか）と“昇格ルール（docsに残す基準）”を定義する。
- 作業中に参照・更新したものは、必要に応じて `docs/` に“昇格”させる（Livingとして継続更新する）。
- 物理移動（Reference領域への集約）は、リンク切れや差分肥大を避けるため、ユースケース単位で小さく段階的に行う（必要になった時だけ）。

### 第一指標（作業時間）と難しさ・運用ルール
- 第一指標は「ユースケース/ストーリー単位の作業時間」とする（機能追加工数の跳ね上がりを検知・抑制するため）。
- 難しい要素：ユースケース粒度の揺れ、学習/調査時間の混入、待ち時間や割り込みによるノイズで、比較可能性が崩れやすい。
- 対策（最低限のルール）：
  - 計測対象は原則「アクティブ作業時間」とし、待ち/中断/調査はカテゴリ分けして別記録する。
  - 追加要件が入ったら同一ユースケースに混ぜず、別ユースケースとして切り出す（粒度固定）。
  - 単発の数値ではなく、直近N本の平均などで推移を見る。

