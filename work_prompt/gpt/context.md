## ここまでの合意事項（要約）

### ゴール/目的
- **目的**: ドキュメントが残っていない状態のプロダクトをリファクタリングし、継続開発可能にする。
- **目標**: 機能追加/保守の工数が指数関数的に増えない（線形に近づける）。

### 対象スコープ
- **リポジトリ全体**を対象にする。
- ただし、全体を同時に触るのではなく「代表フロー（E2Eの背骨）」を起点に順序立てて進める。

### 進め方（方針）
- **TDDベース**で進める（人間が承認し、AIが作業を進める）。
- **主戦場はE2E**（人が見る/仕様として残る）だが、結合/ユニットも補助的に使って理解と安全網を増やす。
- トレードオフがある変更は **最低3案**で比較し、選択を **ADR** に残す。

### 迷子にならない順序（背骨アプローチ）
- 最初の代表フロー（背骨）は **「商品一覧→詳細→カート追加→カート表示」**。
- 背骨フローを **E2Eで“仕様（Living Documentation）”として固定**（Given-When-Thenで明文化し、フレーク要因を潰す）。
- 次に、背骨経路上の **I/O境界（DB/外部サービス/セッション/キャッシュ等）**を洗い出し、変更が起きやすい箇所から **最小の切り出し**を行う。
- 切り出しは、E2E中心を維持しつつ **結合/ユニットで“速い安全網”を追加してから**進める。
- 背骨が安定したら、2本目以降の代表フローへ **横展開**し、同じ手順を繰り返す。

### ドキュメント整理方針（C案）
- 着手前に文書を一括で移動しない（差分が巨大化しやすく迷子の原因になりやすい）。
- まずは物理的な場所を大きく変えずに、`docs/` を **信頼できる最小集合（Living Documentation）**として育てる。
- 既存の散在ドキュメントは **Reference（参考/アーカイブ）**として扱い、**索引**と **“昇格ルール（docsに残す基準）”**を定義する。
- 作業中に参照・更新したものは必要に応じて `docs/` に **昇格**させる。
- 物理移動（集約）は **ユースケース単位で小さく段階的**に、必要になった時だけ行う。

### 第一指標（作業時間）と運用
- 第一指標は **「ユースケース/ストーリー単位の作業時間」**。
- 目的: 過去のテスト漏れ/一貫性の欠如などで追加工数が跳ね上がる事象を防ぐ・検知する。
- 難しさ: 粒度の揺れ、学習/調査時間の混入、待ち/割り込みノイズで比較可能性が崩れやすい。
- 対策:
  - 計測対象は原則 **アクティブ作業時間**（待ち/中断/調査はカテゴリ分けして別記録）。
  - 追加要件が入ったら同一ユースケースに混ぜず **別ユースケースに切る**（粒度固定）。
  - 単発の数値ではなく **直近N本の平均**などで推移を見る。

### 追加で確定した前提
- 作業時間ログの置き場所: **`docs/product/`（a）**
- 背骨フローの前提: **ゲスト（ログインなし）でOK**


